import{f as W,r as m,m as q,c as r,a as t,i as u,l as s,F as J,j as M,t as a,n as w,p as N,b as n,w as c,d as y,k as H,o as l,_ as ee}from"#entry";import te from"./i30gL-sh.js";import se from"./CUfr7WFU.js";import oe from"./DEJXHsuA.js";import re from"./DbAtcd_L.js";import le from"./z4XFoUhE.js";import{u as ie}from"./CMV05MUf.js";import{u as ne}from"./BTRvYBxn.js";import"./CdmUVqsY.js";import"./cOAiAd2k.js";import"./5KMH74Ch.js";import"./CQHT0i2j.js";import"./44lpdJwz.js";import"./BJ2ClxiI.js";import"./Cd8xZgT4.js";import"./CHOj1P8S.js";const ae=globalThis.setInterval,de={class:"container"},_e={class:"import"},me={class:"import__content"},ue={key:0,class:"import__methods"},pe=["onClick"],ce={class:"import__method-icon"},ve={class:"import__method-title"},fe={class:"import__method-description"},he={key:1,class:"import__form"},ge={class:"import__form-title"},ye={key:0,class:"import__dropzone-container"},xe={class:"import__dropzone-text"},ke={key:0,class:"import__dropzone-subtext"},Ie={key:1,class:"form-grid"},be={key:2,class:"import__sample"},we={class:"flex items-center gap-3"},Ce={class:"import__actions"},De={key:2,class:"import__progress"},Se={class:"import__progress-text"},Ue={key:3,class:"import__results"},ze={class:"import__results-header"},Ee={class:"import__results-summary"},Ve={class:"import__summary-item"},Fe={class:"import__summary-value"},Ae={class:"import__summary-item"},Ge={class:"import__summary-value import__summary-value--success"},Je={class:"import__summary-item"},Me={class:"import__summary-value import__summary-value--error"},Ne={key:0,class:"import__errors"},Te={class:"import__errors-title"},Be={class:"import__error-list"},Re={class:"import__error-row"},Ye={class:"import__error-messages"},$e={key:0,class:"import__error-details"},Oe={class:"import__error-data"},Ze={key:0,class:"text-sm text-gray-500 text-center p-4"},je={key:1,class:"import__actions"},Xe=W({__name:"import",setup(Ke){const C=ie(),D=ne(),d=m(null),I=m(!1),f=m(!1),h=m(0),_=m(null),v=m(null),b=m(!1),S=m(),T=m(),x=m(null),p=m({spreadsheetId:"",range:"A:Z"}),U=[{type:"file",icon:"heroicons:document-arrow-up",title:"Загрузить файл",description:"Выберите Excel (.xlsx, .xls) или CSV файл с данными"},{type:"google_sheets",icon:"heroicons:table-cells",title:"Google Sheets",description:"Введите ID таблицы или вставьте полную ссылку"}],z=q(()=>d.value==="file"?!!x.value:d.value==="google_sheets"?!!p.value.spreadsheetId.trim():!1),B=o=>{d.value=o,I.value=!0,v.value=null},R=o=>U.find(g=>g.type===o)?.title||"",E=()=>{I.value=!1,d.value=null,x.value=null,v.value=null,p.value={spreadsheetId:"",range:"A:Z"}},Y=()=>{_.value=null,h.value=0,E()},$=()=>{S.value?.click()},O=o=>{const e=o.target.files;e&&e.length>0&&V(e[0])},Z=o=>{b.value=!1;const e=o.dataTransfer?.files;e&&e.length>0&&V(e[0])},j=()=>{b.value=!0},X=()=>{b.value=!1},V=o=>{if(!["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-excel","text/csv"].includes(o.type)){v.value="Неподдерживаемый формат файла",x.value=null;return}if(o.size>10*1024*1024){v.value="Файл слишком большой (максимум 10MB)",x.value=null;return}v.value=null,x.value=o},K=()=>{d.value==="google_sheets"&&(p.value.spreadsheetId="1JSxXiuWX9dJEeUKGYUY4EsQ5wJln7acNr7UEpA20Ys0",p.value.range="A:Z")},L=async()=>{if(z.value)try{f.value=!0,h.value=0;const o=ae(()=>{h.value<90&&(h.value+=Math.random()*30)},500);let e;if(d.value==="file"&&x.value)e=await C.importData.fromFile(x.value);else if(d.value==="google_sheets")e=await C.importData.fromGoogleSheets(p.value.spreadsheetId,p.value.range);else throw new Error("Неверный метод импорта");clearInterval(o),h.value=100,_.value=e;const g=e.errors.length>0?`Импорт завершен с ошибками. Успешно: ${e.successfulImports}, Ошибок: ${e.errors.length}`:`Импорт успешно завершен! Добавлено продуктов: ${e.successfulImports}`;D.add({title:"Импорт завершен",description:g,color:e.errors.length>0?"yellow":"green"})}catch(o){h.value=0,D.add({title:"Ошибка импорта",description:o instanceof Error?o.message:"Произошла неизвестная ошибка",color:"red"})}finally{f.value=!1}};return(o,e)=>{const g=H,F=te,A=se,k=oe,P=re,Q=le;return l(),r("div",de,[t("div",_e,[e[16]||(e[16]=t("div",{class:"import__header"},[t("h1",{class:"import__title"},"Импорт продуктов"),t("p",{class:"import__subtitle"}," Загрузите данные из Excel файла, CSV или Google Sheets ")],-1)),t("div",me,[s(I)?u("",!0):(l(),r("div",ue,[(l(),r(J,null,M(U,i=>t("div",{key:i.type,class:N(["import__method",{"import__method--active":s(d)===i.type}]),onClick:G=>B(i.type)},[t("div",ce,[n(g,{name:i.icon},null,8,["name"])]),t("h3",ve,a(i.title),1),t("p",fe,a(i.description),1)],10,pe)),64))])),s(I)?(l(),r("div",he,[t("div",ge,a(R(s(d))),1),s(d)==="file"?(l(),r("div",ye,[t("div",{ref_key:"dropzoneRef",ref:T,class:N(["import__dropzone",{"import__dropzone--dragover":s(b),"import__dropzone--error":s(v)}]),onClick:$,onDragover:w(j,["prevent"]),onDragleave:w(X,["prevent"]),onDrop:w(Z,["prevent"])},[n(g,{name:s(v)?"heroicons:exclamation-triangle":"heroicons:cloud-arrow-up",class:"import__dropzone-icon"},null,8,["name"]),t("div",xe,a(s(v)||"Перетащите файл сюда или нажмите для выбора"),1),s(v)?u("",!0):(l(),r("div",ke," Поддерживаются форматы: .xlsx, .xls, .csv "))],34),t("input",{ref_key:"fileInputRef",ref:S,type:"file",accept:".xlsx,.xls,.csv",style:{display:"none"},onChange:O},null,544)])):s(d)==="google_sheets"?(l(),r("div",Ie,[n(A,{label:"ID или ссылка Google Sheets",required:""},{help:c(()=>[...e[2]||(e[2]=[y(" Введите ID таблицы или вставьте полную ссылку из браузера ",-1)])]),default:c(()=>[n(F,{modelValue:s(p).spreadsheetId,"onUpdate:modelValue":e[0]||(e[0]=i=>s(p).spreadsheetId=i),placeholder:"1JSxXiuWX9dJEeUKGYUY4EsQ5wJln7acNr7UEpA20Ys0 или полная ссылка",disabled:s(f)},null,8,["modelValue","disabled"])]),_:1}),n(A,{label:"Диапазон (опционально)"},{help:c(()=>[...e[3]||(e[3]=[y(" Например: A:Z, Лист1!A1:F100 ",-1)])]),default:c(()=>[n(F,{modelValue:s(p).range,"onUpdate:modelValue":e[1]||(e[1]=i=>s(p).range=i),placeholder:"A:Z",disabled:s(f)},null,8,["modelValue","disabled"])]),_:1})])):u("",!0),s(d)==="google_sheets"?(l(),r("div",be,[n(P,null,{default:c(()=>[t("div",we,[n(g,{name:"heroicons:light-bulb",class:"text-yellow-500"}),e[5]||(e[5]=t("div",null,[t("p",{class:"font-medium"},"Хотите протестировать?"),t("p",{class:"text-sm text-gray-600 mt-1"}," Используйте наш тестовый файл с образцами данных ")],-1)),n(k,{variant:"outline",size:"sm",onClick:K},{default:c(()=>[...e[4]||(e[4]=[y(" Использовать пример ",-1)])]),_:1})])]),_:1})])):u("",!0),t("div",Ce,[n(k,{variant:"outline",onClick:E,disabled:s(f)},{default:c(()=>[...e[6]||(e[6]=[y(" Назад ",-1)])]),_:1},8,["disabled"]),n(k,{onClick:L,loading:s(f),disabled:!s(z)},{default:c(()=>[y(a(s(f)?"Импортируем...":"Начать импорт"),1)]),_:1},8,["loading","disabled"])])])):u("",!0),s(f)?(l(),r("div",De,[t("div",Se,[e[7]||(e[7]=t("span",null,"Импорт данных...",-1)),t("span",null,a(s(h))+"%",1)]),n(Q,{value:s(h)},null,8,["value"])])):u("",!0),s(_)?(l(),r("div",Ue,[t("div",ze,[e[9]||(e[9]=t("h2",{class:"import__results-title"},"Результаты импорта",-1)),n(k,{variant:"outline",onClick:Y,icon:"heroicons:arrow-path"},{default:c(()=>[...e[8]||(e[8]=[y(" Новый импорт ",-1)])]),_:1})]),t("div",Ee,[t("div",Ve,[t("div",Fe,a(s(_).totalRows),1),e[10]||(e[10]=t("div",{class:"import__summary-label"}," Всего строк ",-1))]),t("div",Ae,[t("div",Ge,a(s(_).successfulImports),1),e[11]||(e[11]=t("div",{class:"import__summary-label"}," Успешно ",-1))]),t("div",Je,[t("div",Me,a(s(_).errors.length),1),e[12]||(e[12]=t("div",{class:"import__summary-label"}," Ошибок ",-1))])]),s(_).errors.length>0?(l(),r("div",Ne,[t("div",Te,[n(g,{name:"heroicons:exclamation-triangle"}),e[13]||(e[13]=y(" Ошибки импорта ",-1))]),t("div",Be,[(l(!0),r(J,null,M(s(_).errors.slice(0,10),(i,G)=>(l(),r("div",{key:G,class:"import__error-item"},[t("div",Re," Строка "+a(i.row),1),t("div",Ye,a(i.errors.join(", ")),1),i.data?(l(),r("details",$e,[e[14]||(e[14]=t("summary",{class:"cursor-pointer text-sm text-gray-500 hover:text-gray-700"}," Показать данные строки ",-1)),t("div",Oe,a(JSON.stringify(i.data,null,2)),1)])):u("",!0)]))),128)),s(_).errors.length>10?(l(),r("div",Ze," И еще "+a(s(_).errors.length-10)+" ошибок... ",1)):u("",!0)])])):u("",!0),s(_).successfulImports>0?(l(),r("div",je,[n(k,{to:"/products",icon:"heroicons:eye"},{default:c(()=>[...e[15]||(e[15]=[y(" Посмотреть продукты ",-1)])]),_:1})])):u("",!0)])):u("",!0)])])])}}}),_t=ee(Xe,[["__scopeId","data-v-313241fc"]]);export{_t as default};
