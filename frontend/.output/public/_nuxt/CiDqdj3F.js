import x from"./DEJXHsuA.js";import ut from"./i30gL-sh.js";import dt from"./CUfr7WFU.js";import tt from"./Ct-OQf3r.js";import{l as o,f as N,r as $,m as E,y as Q,c as _,a as r,b as u,w as U,n as T,o as i,d as S,v as q,i as b,k as H,t as k,x as F,_ as J,h as et,z as A,A as pt,F as R,p as K,B as _t,j as X}from"#entry";import mt from"./CdmUVqsY.js";import vt from"./B7KU8noN.js";import ft from"./DBVVpIy_.js";import{u as ot}from"./CMV05MUf.js";import{u as ht}from"./BTRvYBxn.js";import"./44lpdJwz.js";import"./BJ2ClxiI.js";import"./Cd8xZgT4.js";import"./cOAiAd2k.js";import"./CQHT0i2j.js";import"./CHOj1P8S.js";import"./5KMH74Ch.js";import"./DlraI2__.js";function Y(f){return typeof f=="function"?f():o(f)}typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const Z=()=>{};function gt(f,m){function s(...d){return new Promise((n,p)=>{Promise.resolve(f(()=>m.apply(this,d),{fn:m,thisArg:this,args:d})).then(n).catch(p)})}return s}function yt(f,m={}){let s,d,n=Z;const p=v=>{clearTimeout(v),n(),n=Z};return v=>{const c=Y(f),e=Y(m.maxWait);return s&&p(s),c<=0||e!==void 0&&e<=0?(d&&(p(d),d=null),Promise.resolve(v())):new Promise((g,a)=>{n=m.rejectOnCancel?a:g,e&&!d&&(d=setTimeout(()=>{s&&p(s),d=null,g(v())},e)),s=setTimeout(()=>{d&&p(d),d=null,g(v())},c)})}}function bt(f,m=200,s={}){return gt(yt(m,s),f)}const kt={class:"products__filters"},wt={class:"products__filters-actions"},$t=N({__name:"ProductFilters",props:{filters:{},filterOptions:{},loading:{type:Boolean,default:!1}},emits:["apply","clear"],setup(f,{emit:m}){const s=f,d=m,n=$({...s.filters}),p=E(()=>[{label:"Все бренды",value:""},...s.filterOptions.brands.map(a=>({label:a,value:a}))]),C=E(()=>[{label:"Все категории",value:""},...s.filterOptions.categories.map(a=>({label:a,value:a}))]),v=[{label:"Все статусы",value:""},{label:"Активный",value:"active"},{label:"Неактивный",value:"inactive"},{label:"Ожидает",value:"pending"}],c=()=>{const a=Object.fromEntries(Object.entries(n.value).filter(([l,P])=>P!=null&&P!==""));d("apply",a)},e=()=>{n.value={},d("clear")};Q(()=>s.filters,a=>{n.value={...a}},{deep:!0});const g=bt(()=>{c()},500);return Q(()=>n.value.search,()=>{g()}),(a,l)=>{const P=ut,B=dt,D=tt,I=x;return i(),_("div",kt,[r("form",{onSubmit:T(c,["prevent"]),class:"products__filters-grid"},[u(B,{label:"Поиск"},{default:U(()=>[u(P,{modelValue:o(n).search,"onUpdate:modelValue":l[0]||(l[0]=h=>o(n).search=h),placeholder:"Поиск по названию или описанию...",icon:"heroicons:magnifying-glass"},null,8,["modelValue"])]),_:1}),u(B,{label:"Бренд"},{default:U(()=>[u(D,{modelValue:o(n).brand,"onUpdate:modelValue":l[1]||(l[1]=h=>o(n).brand=h),options:o(p),placeholder:"Выберите бренд"},null,8,["modelValue","options"])]),_:1}),u(B,{label:"Категория"},{default:U(()=>[u(D,{modelValue:o(n).category,"onUpdate:modelValue":l[2]||(l[2]=h=>o(n).category=h),options:o(C),placeholder:"Выберите категорию"},null,8,["modelValue","options"])]),_:1}),u(B,{label:"Статус"},{default:U(()=>[u(D,{modelValue:o(n).status,"onUpdate:modelValue":l[3]||(l[3]=h=>o(n).status=h),options:v,placeholder:"Выберите статус"},null,8,["modelValue"])]),_:1}),u(B,{label:"Цена от"},{default:U(()=>[u(P,{modelValue:o(n).minPrice,"onUpdate:modelValue":l[4]||(l[4]=h=>o(n).minPrice=h),modelModifiers:{number:!0},type:"number",placeholder:"0",min:"0",step:"0.01"},null,8,["modelValue"])]),_:1}),u(B,{label:"Цена до"},{default:U(()=>[u(P,{modelValue:o(n).maxPrice,"onUpdate:modelValue":l[5]||(l[5]=h=>o(n).maxPrice=h),modelModifiers:{number:!0},type:"number",placeholder:"99999",min:"0",step:"0.01"},null,8,["modelValue"])]),_:1})],32),r("div",wt,[u(I,{type:"button",variant:"outline",onClick:e},{default:U(()=>[...l[6]||(l[6]=[S(" Очистить ",-1)])]),_:1}),u(I,{type:"button",onClick:c},{default:U(()=>[...l[7]||(l[7]=[S(" Применить ",-1)])]),_:1})])])}}}),Ct={class:"product-card__image-container"},Pt=["src","alt"],Vt={key:1,class:"product-card__image product-card__image--placeholder"},Ut={key:2,class:"product-card__badge"},Bt={class:"product-card__content"},Et={key:0,class:"product-card__brand"},Dt={class:"product-card__title"},St={key:1,class:"product-card__description"},Ft={class:"product-card__meta"},It={class:"product-card__price"},Ot={class:"product-card__actions"},At=N({__name:"ProductCard",props:{product:{},showEditButton:{type:Boolean,default:!1},showDeleteButton:{type:Boolean,default:!1}},emits:["edit","delete"],setup(f,{emit:m}){const s=f,d=m,n=q(),p=E(()=>s.product.price?new Intl.NumberFormat("ru-RU",{style:"currency",currency:"RUB"}).format(s.product.price):"Цена не указана"),C=()=>{n.push(`/products/${s.product.id}`)},v=e=>{e&&(e.preventDefault(),e.stopPropagation()),console.log("Переход к редактированию товара:",s.product.id),n.push(`/products/${s.product.id}-edit`)},c=()=>{d("delete",s.product)};return(e,g)=>{const a=H,l=x;return i(),_("article",{class:"product-card",onClick:C},[r("div",Ct,[e.product.imageUrl?(i(),_("img",{key:0,src:e.product.imageUrl,alt:e.product.name,class:"product-card__image",loading:"lazy"},null,8,Pt)):(i(),_("div",Vt,[u(a,{name:"heroicons:photo",size:"48"})])),e.product.status?(i(),_("div",Ut,k(e.product.status),1)):b("",!0)]),r("div",Bt,[e.product.brand?(i(),_("div",Et,k(e.product.brand),1)):b("",!0),r("h3",Dt,k(e.product.name),1),e.product.description?(i(),_("p",St,k(e.product.description),1)):b("",!0),r("div",Ft,[r("div",It,k(o(p)),1),r("div",Ot,[e.showEditButton?(i(),F(l,{key:0,icon:"heroicons:pencil",size:"sm",variant:"ghost",onClick:T(v,["prevent","stop"]),"aria-label":"Редактировать"})):b("",!0),e.showDeleteButton?(i(),F(l,{key:1,icon:"heroicons:trash",size:"sm",variant:"ghost",color:"red",onClick:T(c,["stop"]),"aria-label":"Удалить"})):b("",!0)])])])])}}}),Tt=J(At,[["__scopeId","data-v-35937511"]]),zt=["src","alt"],Lt={key:1,class:"product-list-item__image product-list-item__image--placeholder"},Mt={class:"product-list-item__content"},Rt={class:"product-list-item__header"},xt={class:"product-list-item__title"},Nt={key:0,class:"product-list-item__brand"},jt={class:"product-list-item__price"},Wt={key:0,class:"product-list-item__description"},Gt={class:"product-list-item__meta"},Kt={key:0,class:"product-list-item__status"},qt={class:"product-list-item__actions"},Ht=N({__name:"ProductListItem",props:{product:{},showEditButton:{type:Boolean,default:!1},showDeleteButton:{type:Boolean,default:!1}},emits:["edit","delete"],setup(f,{emit:m}){const s=f,d=m,n=q(),p=E(()=>s.product.price?new Intl.NumberFormat("ru-RU",{style:"currency",currency:"RUB"}).format(s.product.price):"Цена не указана"),C=()=>{n.push(`/products/${s.product.id}`)},v=e=>{e&&(e.preventDefault(),e.stopPropagation()),console.log("Переход к редактированию товара:",s.product.id),n.push(`/products/${s.product.id}-edit`)},c=()=>{d("delete",s.product)};return(e,g)=>{const a=H,l=x;return i(),_("article",{class:"product-list-item",onClick:C},[e.product.imageUrl?(i(),_("img",{key:0,src:e.product.imageUrl,alt:e.product.name,class:"product-list-item__image",loading:"lazy"},null,8,zt)):(i(),_("div",Lt,[u(a,{name:"heroicons:photo",size:"24"})])),r("div",Mt,[r("div",Rt,[r("div",null,[r("h3",xt,k(e.product.name),1),e.product.brand?(i(),_("div",Nt,k(e.product.brand),1)):b("",!0)]),r("div",jt,k(o(p)),1)]),e.product.description?(i(),_("p",Wt,k(e.product.description),1)):b("",!0),r("div",Gt,[e.product.status?(i(),_("div",Kt,k(e.product.status),1)):b("",!0),r("div",qt,[e.showEditButton?(i(),F(l,{key:0,icon:"heroicons:pencil",size:"sm",variant:"ghost",onClick:T(v,["prevent","stop"]),"aria-label":"Редактировать"})):b("",!0),e.showDeleteButton?(i(),F(l,{key:1,icon:"heroicons:trash",size:"sm",variant:"ghost",color:"red",onClick:T(c,["stop"]),"aria-label":"Удалить"})):b("",!0)])])])])}}}),Jt=J(Ht,[["__scopeId","data-v-16604392"]]),Qt=()=>{const f=ot(),m=$([]),s=$("idle"),d=$(null),n=$(0),p=$(1),C=$(0),v=$({}),c=$({page:1,limit:12,sortBy:"createdAt",sortOrder:"DESC"}),e=$("grid"),g=$({brands:[],categories:[]}),a=async()=>{try{s.value="loading",d.value=null;const t=await f.products.getAll(v.value,c.value);m.value=t.data,n.value=t.total,p.value=t.page,C.value=t.totalPages,s.value="success"}catch(t){s.value="error",d.value=t instanceof Error?t.message:"Произошла ошибка",console.error("Error fetching products:",t)}},l=async()=>{try{g.value=await f.products.getFilters()}catch(t){console.error("Error fetching filters:",t)}},P=t=>{v.value={...t},c.value.page=1,a()},B=()=>{v.value={},c.value.page=1,a()},D=t=>{c.value.page=t,a()},I=t=>{c.value.limit=t,c.value.page=1,a()},h=(t,w="DESC")=>{c.value.sortBy=t,c.value.sortOrder=w,c.value.page=1,a()},z=()=>{e.value=e.value==="grid"?"list":"grid"},j=t=>{v.value.search=t,c.value.page=1,a()},O=E(()=>s.value==="loading"),W=E(()=>s.value==="error"),L=E(()=>m.value.length===0&&s.value==="success"),M=E(()=>m.value.length>0),y=E(()=>{const t=(p.value-1)*c.value.limit+1,w=Math.min(t+c.value.limit-1,n.value);return{start:t,end:w,total:n.value,currentPage:p.value,totalPages:C.value}});return et(()=>{a(),l()}),{products:A(m),loading:A(s),error:A(d),filters:A(v),pagination:A(c),viewMode:e,filterOptions:A(g),isLoading:O,hasError:W,isEmpty:L,hasProducts:M,paginationInfo:y,fetchProducts:a,fetchFilters:l,applyFilters:P,clearFilters:B,changePage:D,changeLimit:I,changeSort:h,toggleViewMode:z,search:j}},Xt={class:"container"},Yt={class:"products"},Zt={class:"products__header"},te={class:"products__actions"},ee={class:"products__toolbar"},oe={class:"products__toolbar-left"},se={class:"products__results-info"},ne={class:"products__toolbar-right"},re={class:"products__view-toggle"},ae={key:0,class:"products__loading"},le={key:2,class:"products__empty"},ie={key:4,class:"products__pagination-container"},ce=N({__name:"index",setup(f){const{products:m,error:s,filters:d,pagination:n,viewMode:p,filterOptions:C,isLoading:v,hasError:c,isEmpty:e,hasProducts:g,paginationInfo:a,fetchProducts:l,applyFilters:P,clearFilters:B,changePage:D,changeSort:I}=Qt(),h=q(),z=ht(),j=[{label:"Новые сначала",value:"createdAt:DESC"},{label:"Старые сначала",value:"createdAt:ASC"},{label:"По названию (А-Я)",value:"name:ASC"},{label:"По названию (Я-А)",value:"name:DESC"},{label:"По цене (дешевые)",value:"price:ASC"},{label:"По цене (дорогие)",value:"price:DESC"}],O=$("createdAt:DESC"),W=()=>{const[y,t]=O.value.split(":");I(y,t)},L=y=>{h.push(`/products/${y.id}-edit`)},M=async y=>{if(confirm(`Вы уверены, что хотите удалить продукт "${y.name}"?`))try{await ot().products.delete(y.id),z.add({title:"Продукт удален",description:`Продукт "${y.name}" успешно удален`,color:"green"}),await l()}catch(w){z.add({title:"Ошибка",description:w instanceof Error?w.message:"Не удалось удалить продукт",color:"red"})}};return et(()=>{const y=t=>{(t.ctrlKey||t.metaKey)&&t.key==="k"&&(t.preventDefault(),document.querySelector('input[placeholder*="Поиск"]')?.focus())};document.addEventListener("keydown",y),pt(()=>{document.removeEventListener("keydown",y)})}),(y,t)=>{const w=x,st=$t,G=H,nt=tt,rt=mt,at=vt,lt=Tt,it=Jt,ct=ft;return i(),_("div",Xt,[r("div",Yt,[r("div",Zt,[t[6]||(t[6]=r("div",null,[r("h1",{class:"products__title"},"Продукты"),r("p",{class:"products__subtitle"}," Управляйте своим каталогом товаров ")],-1)),r("div",te,[u(w,{to:"/import",icon:"heroicons:arrow-up-tray",variant:"outline"},{default:U(()=>[...t[4]||(t[4]=[S(" Импорт ",-1)])]),_:1}),u(w,{to:"/products/new",icon:"heroicons:plus"},{default:U(()=>[...t[5]||(t[5]=[S(" Добавить продукт ",-1)])]),_:1})])]),u(st,{filters:o(d),"filter-options":o(C),loading:o(v),onApply:o(P),onClear:o(B)},null,8,["filters","filter-options","loading","onApply","onClear"]),r("div",ee,[r("div",oe,[r("div",se,[o(g)?(i(),_(R,{key:0},[S(" Показано "+k(o(a).start)+"-"+k(o(a).end)+" из "+k(o(a).total)+" продуктов ",1)],64)):o(v)?b("",!0):(i(),_(R,{key:1},[S(" Продукты не найдены ")],64))])]),r("div",ne,[r("div",re,[r("button",{type:"button",class:K(["products__view-button",{"products__view-button--active":o(p)==="grid"}]),onClick:t[0]||(t[0]=V=>p.value="grid"),"aria-label":"Сетка"},[u(G,{name:"heroicons:squares-2x2"})],2),r("button",{type:"button",class:K(["products__view-button",{"products__view-button--active":o(p)==="list"}]),onClick:t[1]||(t[1]=V=>p.value="list"),"aria-label":"Список"},[u(G,{name:"heroicons:list-bullet"})],2)]),u(nt,{modelValue:o(O),"onUpdate:modelValue":t[2]||(t[2]=V=>_t(O)?O.value=V:null),options:j,class:"products__sort-select",onChange:W},null,8,["modelValue"])])]),o(v)?(i(),_("div",ae,[u(rt,{name:"heroicons:arrow-path",class:"animate-spin",size:"48"}),t[7]||(t[7]=r("p",{class:"products__loading-text"},"Загрузка продуктов...",-1))])):o(c)?(i(),F(at,{key:1,icon:"heroicons:exclamation-triangle",color:"red",variant:"soft",title:o(s)||"Произошла ошибка","close-button":{icon:"heroicons:x-mark-20-solid",color:"red",variant:"link"},onClose:o(l)},null,8,["title","onClose"])):o(e)?(i(),_("div",le,[u(G,{name:"heroicons:cube-transparent",class:"products__empty-icon"}),t[9]||(t[9]=r("h3",{class:"products__empty-title"},"Продукты не найдены",-1)),t[10]||(t[10]=r("p",{class:"products__empty-description"}," Попробуйте изменить фильтры или импортировать новые данные ",-1)),u(w,{to:"/import",icon:"heroicons:arrow-up-tray"},{default:U(()=>[...t[8]||(t[8]=[S(" Импортировать данные ",-1)])]),_:1})])):o(g)?(i(),_("div",{key:3,class:K(["products__grid",`products__grid--${o(p)}`])},[o(p)==="grid"?(i(!0),_(R,{key:0},X(o(m),V=>(i(),F(lt,{key:V.id,product:V,"show-edit-button":!0,"show-delete-button":!0,onEdit:L,onDelete:M},null,8,["product"]))),128)):(i(!0),_(R,{key:1},X(o(m),V=>(i(),F(it,{key:V.id,product:V,"show-edit-button":!0,"show-delete-button":!0,onEdit:L,onDelete:M},null,8,["product"]))),128))],2)):b("",!0),o(g)?(i(),_("div",ie,[u(ct,{modelValue:o(n).page,"onUpdate:modelValue":t[3]||(t[3]=V=>o(n).page=V),"page-count":o(n).limit,total:y.total,max:5,onChange:o(D)},null,8,["modelValue","page-count","total","onChange"])])):b("",!0)])])}}}),Be=J(ce,[["__scopeId","data-v-cf596039"]]);export{Be as default};
